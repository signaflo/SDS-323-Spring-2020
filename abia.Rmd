---
title: "abia"
author: "Crystal Tse"
date: "2/8/2020"
output: html_document
---

```{r}
library(mosaic)
library(tidyverse)
library(RColorBrewer)

abia = read.csv("abia.csv")
```
# What time of year and destinations are the worst for cancellation?

```{r}
# filter out flights that are not cancelled
cancelled = abia %>%
  filter(Cancelled == 1)
```

```{r}
# group by destination and then summarize with count
# top destinations
ten_most_visited = abia %>% filter(Dest != "AUS") %>% group_by(Dest) %>% summarize(count = n()) %>% arrange(-count)

ten_most_visited = ten_most_visited[1:10,]
```

```{r}
most_visited = abia[abia$Dest == ten_most_visited$Dest,]
ten_most_visited = inner_join(abia, ten_most_visited, by = "Dest")
```
The graph below plots month and cancellation rate for each destination (out of all cancelled flights). One particularly surprising finding is that the largest proportion of cancelled flights occur in March and April, whereas October has virtually none. 
```{r}
ggplot(data = ten_most_visited, 
  aes(x = Month, y = (Cancelled /(sum(Cancelled == 1))), fill = Dest)) +
  geom_bar(stat = "identity") + 
  scale_fill_brewer(palette = "Spectral") + 
  scale_x_discrete(limits = month.abb) +
  ggtitle("Cancellation Rates for Top 10 Destinations") +
  labs(y = "Sum of Cancellations", x = "Month") +
  labs(fill = "Destination")

```

```{r}
# try to reorder by cancellation rate, instead of alphabetically ## debug
abia$Dest = factor(abia$Dest, levels=
  abia$Dest[order(abia$sum(Cancelled))])

```
Delays are also very low in October, but in contrast to the high number of cancellations in September, there are relatively few delays. December is worst for delays, alongside February and March. March is consistently the worst month for both cancellations and departure delays.
```{r}
# Investigate median departure delays by month.

departure_delays_by_month <- abia %>% 
  group_by(Month) %>% 
  filter(DepDelay > 0) %>% 
  # Take the median since the distribution is highly skewed.
  summarize(delay = median(DepDelay, na.rm = TRUE)) %>%
  select(delay) %>% 
  mutate(month = month.name)

ggplot(data = departure_delays_by_month) +
  geom_point(
    mapping = aes(x = delay, y = month),
    color = "red",
    size = 3
  ) +
  geom_vline(xintercept = 0, size = .25) +
  xlim(c(0, 20)) +
  scale_y_discrete(limits = rev(month.name)) +
  labs(title = "Median Departure Delay by Month", y = "", x = "Delay in Minutes")
```

```{r}
arrival_delays_by_month <- abia %>% 
  group_by(Month) %>% 
  filter(ArrDelay > 0) %>% 
  # Take the median since the distribution is highly skewed.
  summarize(delay = median(ArrDelay, na.rm = TRUE)) %>%
  select(delay) %>% 
  mutate(month = month.name)

ggplot(data = arrival_delays_by_month) +
  geom_point(
    mapping = aes(x = delay, y = month),
    color = "red",
    size = 3
  ) +
  geom_vline(xintercept = 0, size = .25) +
  xlim(c(0, 20)) +
  scale_y_discrete(limits = rev(month.name)) +
  labs(title = "Median Arrival Delay by Month", y = "", x = "Delay in Minutes")

```







