---
title: "Green Buildings"
author: "Jinfang Yan, Crystal Tse, Kyle Carter, Jacob Rachiele"
date: "2/14/2020"
output: html_document
---
Load in the data, and filter out the buildings with less than 10% occupancy.
```{r setup, include = FALSE}
library(mosaic)
library(tidyverse)
library(kableExtra)
library(knitr)
library(RColorBrewer)
library(ggthemes)
grb = read.csv("data/greenbuildings.csv")
grb = grb %>% 
  filter(leasing_rate>=10)

```

Below is the table without any filter for size (the same as the guru's analysis)
```{r echo = FALSE}
grb %>% 
  group_by(green_rating) %>% 
  summarize(median_rent = median(Rent, na.rm = TRUE)) %>% kable(col.names = c("Green Rating", "Median Rent"), caption = "Median Rent Overall") %>% kable_styling(full_width = F ,position = "left")

```
Since the building we plan to construct is 250,000 square feet, it would be appropriate to limit our focus to buildings within the relevant range of square footage. Below is the table with only buildings with square footage between 200,000 and 300,000. The difference in median rent for green and non-green is only \$0.84 per square foot, instead of the previous consultation of \$2.60 per square foot.
```{r echo = FALSE}

grb %>% filter(size >= 200000 & size <= 300000) %>% 
  group_by(green_rating) %>% 
  summarize(median_rent = median(Rent, na.rm = TRUE))%>% kable(col.names = c("Green Rating", "Median Rent"), caption = "Median Rent by Relevant Area") %>% kable_styling(full_width = F ,position = "left")
```

Therefore, the actual difference in median rent shows that the revenue generated by the green building is not as strong as the previous report suggests. Instead of 250,000 square feet multiplied by \$2.60 extra in revenue for the green building (\$650,000 per year), the difference in median rent for the relevant square footage more closely represents 250,000 * \$0.84, which is an additional \$210,000 per year, assuming the difference in rent is solely attributed to green buildings. There are other potential confounding factors that could also influence this $0.84 difference in rent, especially if green buildings are inherently correlated with certain attributes.

Filtering further for age, since our building will be newly constructed, it is more relevant to focus on buildings that are less than 10 years old.
```{r echo = FALSE}
grb %>% filter(size >= 200000 & size <= 300000 & age < 10) %>% 
  group_by(green_rating) %>% 
  summarize(median_rent = median(Rent, na.rm = TRUE))%>% kable(col.names = c("Green Rating", "Median Rent"), caption = "Median Rent by Relevant Area and Age") %>% kable_styling(full_width = F ,position = "left")
```
The median rent for non-green buildings is actually much higher than that for green buildings if filtering for both square footage and age. Non-green buildings are shown to have a \$7.26 advantage over green buildings, not accounting for other confounding factors.

The previous report's findings correctly filtered out outliers in terms of low occupancy but did not consider the relevant range for the desired building. The focus on newer buildings around 250,000 square feet allows for a more targeted comparison and reveals that simply comparing green and non-green buildings as a whole introduces a host of problems due to the vast range of possible building types.

## Age distribution for Non-Green and Green Buildings
Green Buildings are newer on average than non-green buildings. They are both positively skewed, however the non-green distribution looks almost bimodal. The median will not necessarily be the best indicator since the age is concentrated in two separate areas.

```{r echo= FALSE}
ggplot(grb, aes(x = age, group=factor(green_rating), fill=factor(green_rating))) +
  geom_density(position = "identity", alpha=0.5) +
  labs(x="Age", y="Proportion of Buildings", title="Green Buildings Tend to be Newer", fill="Green Rating")

```

## Class A and Green Rating
Green buildings are more likely to be class_a, which earn a higher median rent. This could be a problem, since it does not accurately represent the supposed advantage of green buildings on their own. It may be possible to earn a high rent without getting a green rating. 
```{r echo=FALSE}

grb <- grb %>% 
  mutate(Build = factor(green_rating, levels = c(1,0),
                        labels = c("Green Building", "Nongreen Building"))) %>% 
  mutate(class=factor(class_a, levels=c(0,1), labels=c("Class B", "Class A")))
ggplot(data = grb) +
  geom_bar(mapping = aes(x = Build, fill = factor(class)), position = "fill") +
  scale_fill_brewer( palette = "Blues") +
  labs(x="Green Rating", y="Proportion of Buildings", title="Most Green Buildings are Class A", fill="Class Rating")+
  theme_few()

grb %>% filter(size >= 200000 & size <= 300000 & age < 10) %>% 
  group_by(class_a) %>% 
  summarize(median_rent = median(Rent, na.rm = TRUE))%>% 
  kable(col.names = c("Class A Rating", "Median Rent"), caption = "Median Rent by Relevant Area and Age for Class A") %>% 
  kable_styling(full_width = F ,position = "left")
```



## Issues with Clusters

The rent for each cluster has a wide range, and may possibly represent regional differences in rent. In addition, there is no information in the data set for the location of the clusters. As such, we are not able to pinpoint exeactly what rent we could expect to charge since it varies so much across clusters. Further, the distribution is positively skewed; we don't know which side of the distribution the rent we charge would be on. It would be useful to gather location information on the clusters so that the analysis could compare local buildings.

```{r echo=FALSE}
#data frame with clusters and cluster rents
crent <- grb %>% 
  group_by(cluster) %>% 
  summarize(cr=mean(cluster_rent))
favstats(~cr, data=crent)
ggplot(data=crent, aes(x=cr))+
  geom_density(fill="lightblue")+
  labs(x="Cluster Rent", y="Density", title="Cluster Rent Disribution")

```


## Issues with Utility Costs
Although gas costs are mostly concentrated around the same level, but electricity costs have wild variation. Again, without knowing the specific location, we cannot know how the electricity and gas costs will factor into the rent.

```{r echo=FALSE}
#filter out the observations that are on a net contract basis
grb_nonet = grb %>% 
  filter(net==0)
#since 

ggplot(data=grb_nonet, aes(x=Gas_Costs))+
  geom_density(fill="light green")+
  labs(x="Gas Costs", y="Number of Buildings")

ggplot(data=grb_nonet, aes(x=Electricity_Costs))+
  geom_density(fill="yellow", alpha=0.7) +
  labs(x="Electricity Costs", y="Number of Buildings")
```


The initial estimate given did not account for many of the variables that could account for rent for green buildings. In order to make a more fair comparison and a thorough analysis, more information is needed. But for starters, the comparison should be made for buildings of the similar size and age. The age distribution is skewed for both green and non-green buildings, so a simple average will not suffice. We showed that the Class A rating may be a confounding variable since most green buildings are Class A. Thus, it may be more worthwhile to pursue a Class A rating instead since buildings with this rating have a higher median rent than Class B buildings. Because rents are highly varied across clusters, and no information is given about the location of these cluster, we do not know how competitive the rent we charge would be, or if it is reasonable for our region. Electricity costs also have a wide range, and it would factor into the rent.

